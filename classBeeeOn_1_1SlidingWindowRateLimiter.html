<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BeeeOn Server: BeeeOn::SlidingWindowRateLimiter Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="BeeeOn.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BeeeOn Server
   &#160;<span id="projectnumber">v2018.11.1</span>
   </div>
   <div id="projectbrief">Platform to interconnect the IoT world</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><b>BeeeOn</b></li><li class="navelem"><a class="el" href="classBeeeOn_1_1SlidingWindowRateLimiter.html">SlidingWindowRateLimiter</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a>  </div>
  <div class="headertitle">
<div class="title">BeeeOn::SlidingWindowRateLimiter Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><a class="el" href="classBeeeOn_1_1SlidingWindowRateLimiter.html" title="SlidingWindowRateLimiter keeps track of a recent amount of messages received from a certain gateway...">SlidingWindowRateLimiter</a> keeps track of a recent amount of messages received from a certain gateway. The amount of messages is defined by the size of the sliding window which is currently fixed to 1 hour. The <a class="el" href="classBeeeOn_1_1SlidingWindowRateLimiter.html" title="SlidingWindowRateLimiter keeps track of a recent amount of messages received from a certain gateway...">SlidingWindowRateLimiter</a> supports policing of messages based of traffic per minute and/or traffic per hour.  
 <a href="classBeeeOn_1_1SlidingWindowRateLimiter.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="SlidingWindowRateLimiter_8h_source.html">SlidingWindowRateLimiter.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for BeeeOn::SlidingWindowRateLimiter:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classBeeeOn_1_1SlidingWindowRateLimiter.png" usemap="#BeeeOn::SlidingWindowRateLimiter_map" alt=""/>
  <map id="BeeeOn::SlidingWindowRateLimiter_map" name="BeeeOn::SlidingWindowRateLimiter_map">
<area href="classBeeeOn_1_1Loggable.html" alt="BeeeOn::Loggable" shape="rect" coords="0,0,208,24"/>
<area href="classBeeeOn_1_1GatewayRateLimiter.html" title="GatewayRateLimiter controls the message rate per gateway. It is supposed to slow down communication i..." alt="BeeeOn::GatewayRateLimiter" shape="rect" coords="218,0,426,24"/>
</map>
 </div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:ab86b98eaacea8f293988ad447df84611"><td class="memItemLeft" align="right" valign="top"><a id="ab86b98eaacea8f293988ad447df84611"></a>
typedef Poco::SharedPtr&lt; <a class="el" href="classBeeeOn_1_1SlidingWindowRateLimiter.html">SlidingWindowRateLimiter</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>Ptr</b></td></tr>
<tr class="separator:ab86b98eaacea8f293988ad447df84611"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_types_classBeeeOn_1_1GatewayRateLimiter"><td colspan="2" onclick="javascript:toggleInherit('pub_types_classBeeeOn_1_1GatewayRateLimiter')"><img src="closed.png" alt="-"/>&#160;Public Types inherited from <a class="el" href="classBeeeOn_1_1GatewayRateLimiter.html">BeeeOn::GatewayRateLimiter</a></td></tr>
<tr class="memitem:a5d5f8a28337b845dd35118b8733fbcc8 inherit pub_types_classBeeeOn_1_1GatewayRateLimiter"><td class="memItemLeft" align="right" valign="top"><a id="a5d5f8a28337b845dd35118b8733fbcc8"></a>
typedef Poco::SharedPtr&lt; <a class="el" href="classBeeeOn_1_1GatewayRateLimiter.html">GatewayRateLimiter</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>Ptr</b></td></tr>
<tr class="separator:a5d5f8a28337b845dd35118b8733fbcc8 inherit pub_types_classBeeeOn_1_1GatewayRateLimiter"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a3288a4bed8c3982a7779945b091ab661"><td class="memItemLeft" align="right" valign="top"><a id="a3288a4bed8c3982a7779945b091ab661"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>SlidingWindowRateLimiter</b> (const <a class="el" href="classBeeeOn_1_1GatewayID.html">GatewayID</a> &amp;id, size_t maxRatePerMinute, size_t maxRatePerHour)</td></tr>
<tr class="separator:a3288a4bed8c3982a7779945b091ab661"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae2106c9f4e0fbd795378e10f1123f5ab"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBeeeOn_1_1SlidingWindowRateLimiter.html#ae2106c9f4e0fbd795378e10f1123f5ab">accept</a> (const GWMessage::Ptr msg) override</td></tr>
<tr class="memdesc:ae2106c9f4e0fbd795378e10f1123f5ab"><td class="mdescLeft">&#160;</td><td class="mdescRight">Accepting of all messages uses the same algorithm. The call is thread-safe.  <a href="#ae2106c9f4e0fbd795378e10f1123f5ab">More...</a><br /></td></tr>
<tr class="separator:ae2106c9f4e0fbd795378e10f1123f5ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a799611397d86bbe21e4a7c227e901fa3"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBeeeOn_1_1SlidingWindowRateLimiter.html#a799611397d86bbe21e4a7c227e901fa3">accept</a> () override</td></tr>
<tr class="memdesc:a799611397d86bbe21e4a7c227e901fa3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Accepting of all messages uses the same algorithm. The call is thread-safe.  <a href="#a799611397d86bbe21e4a7c227e901fa3">More...</a><br /></td></tr>
<tr class="separator:a799611397d86bbe21e4a7c227e901fa3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classBeeeOn_1_1GatewayRateLimiter"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_classBeeeOn_1_1GatewayRateLimiter')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="classBeeeOn_1_1GatewayRateLimiter.html">BeeeOn::GatewayRateLimiter</a></td></tr>
<tr class="memitem:ae1c00b8e8409c48ba60883e48c000fb9 inherit pub_methods_classBeeeOn_1_1GatewayRateLimiter"><td class="memItemLeft" align="right" valign="top"><a id="ae1c00b8e8409c48ba60883e48c000fb9"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>GatewayRateLimiter</b> (const <a class="el" href="classBeeeOn_1_1GatewayID.html">GatewayID</a> &amp;id)</td></tr>
<tr class="separator:ae1c00b8e8409c48ba60883e48c000fb9 inherit pub_methods_classBeeeOn_1_1GatewayRateLimiter"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc7b5448b01c4de3d3af84a39d8ea8fd inherit pub_methods_classBeeeOn_1_1GatewayRateLimiter"><td class="memItemLeft" align="right" valign="top"><a id="acc7b5448b01c4de3d3af84a39d8ea8fd"></a>
const <a class="el" href="classBeeeOn_1_1GatewayID.html">GatewayID</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><b>gatewayID</b> () const</td></tr>
<tr class="separator:acc7b5448b01c4de3d3af84a39d8ea8fd inherit pub_methods_classBeeeOn_1_1GatewayRateLimiter"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:a8cd44f3f2d630b7462982549f74a5fed"><td class="memItemLeft" align="right" valign="top"><a id="a8cd44f3f2d630b7462982549f74a5fed"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBeeeOn_1_1SlidingWindowRateLimiter.html#a8cd44f3f2d630b7462982549f74a5fed">doAccept</a> (const Poco::Timespan &amp;now)</td></tr>
<tr class="memdesc:a8cd44f3f2d630b7462982549f74a5fed"><td class="mdescLeft">&#160;</td><td class="mdescRight">Move the sliding window according to the current time represented as Poco::Timespan and check whether the current message fits into all limits. <br /></td></tr>
<tr class="separator:a8cd44f3f2d630b7462982549f74a5fed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a24e580436b7f732901c56f6f6aa4a674"><td class="memItemLeft" align="right" valign="top"><a id="a24e580436b7f732901c56f6f6aa4a674"></a>
Poco::Timespan&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBeeeOn_1_1SlidingWindowRateLimiter.html#a24e580436b7f732901c56f6f6aa4a674">align</a> (const Poco::Timespan &amp;timespan) const</td></tr>
<tr class="memdesc:a24e580436b7f732901c56f6f6aa4a674"><td class="mdescLeft">&#160;</td><td class="mdescRight">Align the given time to multiples of 30 seconds. <br /></td></tr>
<tr class="separator:a24e580436b7f732901c56f6f6aa4a674"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb771998faac5cd2fcb9ce41b739ec4f"><td class="memItemLeft" align="right" valign="top"><a id="adb771998faac5cd2fcb9ce41b739ec4f"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBeeeOn_1_1SlidingWindowRateLimiter.html#adb771998faac5cd2fcb9ce41b739ec4f">overlimit</a> (const Poco::Timespan &amp;now) const</td></tr>
<tr class="memdesc:adb771998faac5cd2fcb9ce41b739ec4f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Test overlimit of the current message at the given time point. <br /></td></tr>
<tr class="separator:adb771998faac5cd2fcb9ce41b739ec4f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af4c479a6c7d9f093858eae1427de456d"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBeeeOn_1_1SlidingWindowRateLimiter.html#af4c479a6c7d9f093858eae1427de456d">overlimitGeneric</a> (const Poco::Timespan &amp;now, const Poco::Timespan &amp;range, const size_t maxLimit, const std::string &amp;label) const</td></tr>
<tr class="memdesc:af4c479a6c7d9f093858eae1427de456d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generic algorithm for any time window. It computes number of messages received in the given time range until now. If the amount is greater then the given maxLimit, it returns true.  <a href="#af4c479a6c7d9f093858eae1427de456d">More...</a><br /></td></tr>
<tr class="separator:af4c479a6c7d9f093858eae1427de456d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a46f6c97121dc447c7182243fa6184683"><td class="memItemLeft" align="right" valign="top"><a id="a46f6c97121dc447c7182243fa6184683"></a>
size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBeeeOn_1_1SlidingWindowRateLimiter.html#a46f6c97121dc447c7182243fa6184683">sumRange</a> (const Poco::Timespan &amp;b, const Poco::Timespan &amp;e) const</td></tr>
<tr class="memdesc:a46f6c97121dc447c7182243fa6184683"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sum messages amounts in the given time interval. <br /></td></tr>
<tr class="separator:a46f6c97121dc447c7182243fa6184683"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a993a813c3f2ebf43598800948f83abea"><td class="memItemLeft" align="right" valign="top"><a id="a993a813c3f2ebf43598800948f83abea"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBeeeOn_1_1SlidingWindowRateLimiter.html#a993a813c3f2ebf43598800948f83abea">shiftWindow</a> (const Poco::Timespan &amp;now)</td></tr>
<tr class="memdesc:a993a813c3f2ebf43598800948f83abea"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remove old records from the sliding window. Records older then 1 hour are simply erased. <br /></td></tr>
<tr class="separator:a993a813c3f2ebf43598800948f83abea"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p><a class="el" href="classBeeeOn_1_1SlidingWindowRateLimiter.html" title="SlidingWindowRateLimiter keeps track of a recent amount of messages received from a certain gateway...">SlidingWindowRateLimiter</a> keeps track of a recent amount of messages received from a certain gateway. The amount of messages is defined by the size of the sliding window which is currently fixed to 1 hour. The <a class="el" href="classBeeeOn_1_1SlidingWindowRateLimiter.html" title="SlidingWindowRateLimiter keeps track of a recent amount of messages received from a certain gateway...">SlidingWindowRateLimiter</a> supports policing of messages based of traffic per minute and/or traffic per hour. </p>
<p>Principle:</p>
<ul>
<li>sliding window is divided into slots of size 30 seconds</li>
<li>for each slot, the number of seen messages is measured</li>
<li>when for the most recent minute (usually 2 slots) the measured number of messages reaches the max-rate-per-minute limit, no more messages are accepted until the sliding window is moved enough</li>
<li>when for the most recent hour (usually 120 slots) the measured number of measured reaches the max-rate-per-hour limit, no more messages are accepted until the sliding window is moved enough</li>
<li>if the max-rate-per-minute starts dropping, the max-rate-per-hour is left intact and thus it is not being exhausted by high message rate during a single minute</li>
</ul>
<p>Example:</p>
<ul>
<li>consider max rates: 20 msg/min (M), 70 msg/h (H)</li>
</ul>
<pre>
slot: 0    30   60   90  120  150  180  210  240  270  300 ... 3600
cnt:  |  0 | 15 |  5 |  8 | 12 |  4 | 16 |  4 |  6 |  0 |  ... | 5 |
                   M         M         M    M    H    H
</pre> </div><h2 class="groupheader">Member Function Documentation</h2>
<a id="ae2106c9f4e0fbd795378e10f1123f5ab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae2106c9f4e0fbd795378e10f1123f5ab">&#9670;&nbsp;</a></span>accept() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool SlidingWindowRateLimiter::accept </td>
          <td>(</td>
          <td class="paramtype">const GWMessage::Ptr&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Accepting of all messages uses the same algorithm. The call is thread-safe. </p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="classBeeeOn_1_1SlidingWindowRateLimiter.html#a8cd44f3f2d630b7462982549f74a5fed" title="Move the sliding window according to the current time represented as Poco::Timespan and check whether...">SlidingWindowRateLimiter::doAccept()</a> </dd></dl>

<p>Reimplemented from <a class="el" href="classBeeeOn_1_1GatewayRateLimiter.html#adac3a2388a507ec38043bf1c0b5c6ec2">BeeeOn::GatewayRateLimiter</a>.</p>

</div>
</div>
<a id="a799611397d86bbe21e4a7c227e901fa3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a799611397d86bbe21e4a7c227e901fa3">&#9670;&nbsp;</a></span>accept() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool SlidingWindowRateLimiter::accept </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Accepting of all messages uses the same algorithm. The call is thread-safe. </p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="classBeeeOn_1_1SlidingWindowRateLimiter.html#a8cd44f3f2d630b7462982549f74a5fed" title="Move the sliding window according to the current time represented as Poco::Timespan and check whether...">SlidingWindowRateLimiter::doAccept()</a> </dd></dl>

<p>Implements <a class="el" href="classBeeeOn_1_1GatewayRateLimiter.html#a64c46bccce45fbf92c4896e7e8cb9593">BeeeOn::GatewayRateLimiter</a>.</p>

</div>
</div>
<a id="af4c479a6c7d9f093858eae1427de456d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af4c479a6c7d9f093858eae1427de456d">&#9670;&nbsp;</a></span>overlimitGeneric()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool SlidingWindowRateLimiter::overlimitGeneric </td>
          <td>(</td>
          <td class="paramtype">const Poco::Timespan &amp;&#160;</td>
          <td class="paramname"><em>now</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Poco::Timespan &amp;&#160;</td>
          <td class="paramname"><em>range</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const size_t&#160;</td>
          <td class="paramname"><em>maxLimit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>label</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Generic algorithm for any time window. It computes number of messages received in the given time range until now. If the amount is greater then the given maxLimit, it returns true. </p>
<dl class="section return"><dt>Returns</dt><dd>true if the current message is overlimit, otherwise false. </dd></dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>/home/jviki/Projects/BeeeOn/server/src/policy/<a class="el" href="SlidingWindowRateLimiter_8h_source.html">SlidingWindowRateLimiter.h</a></li>
<li>/home/jviki/Projects/BeeeOn/server/src/policy/SlidingWindowRateLimiter.cpp</li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
