<system>
	<services>
		<instance name="main" class="BeeeOn::UIServerModule">
			<set name="sessionVerifier" ref="sessionVerifier" />
			<set name="placeHandler" ref="placeHandler" />
			<set name="userService" ref="userService" />
			<set name="authHandler" ref="authHandler" />
			<set name="deviceService" ref="deviceService" />
			<set name="gatewayHandler" ref="gatewayHandler" />
			<set name="locationHandler" ref="locationHandler" />
		</instance>

		<instance name="authHandler" class="BeeeOn::RestAuthHandler">
			<set name="authService" ref="authService" />
		</instance>

		<instance name="placeHandler" class="BeeeOn::UI::PlaceHandler">
			<set name="placeService" ref="placeService" />
		</instance>

		<instance name="gatewayHandler" class="BeeeOn::UI::GatewayHandler">
			<set name="gatewayService" ref="gatewayService" />
		</instance>

		<instance name="locationHandler" class="BeeeOn::UI::LocationHandler">
			<set name="locationService" ref="locationService" />
		</instance>

		<instance name="sessionVerifier" class="BeeeOn::SessionVerifier">
			<set name="sessionManager" ref="sessionManager" />
		</instance>

		<instance name="uiMockInit"
				class="BeeeOn::UIMockInit"
				init="early">
			<set name="userDao" ref="mockUserDao" />
			<set name="gatewayDao" ref="mockGatewayDao" />
			<set name="identityDao" ref="identityDao" />
		</instance>

		<!-- Bussiness layer -->

		<instance name="placeService" class="BeeeOn::PlaceService">
			<set name="placeDao" ref="placeDao" />
		</instance>

		<instance name="userService" class="BeeeOn::UserService">
			<set name="userDao" ref="userDao" />
		</instance>

		<instance name="authService" class="BeeeOn::AuthService">
			<set name="userDao" ref="userDao" />
			<set name="identityDao" ref="identityDao" />
			<set name="verifiedIdentityDao" ref="verifiedIdentityDao" />
			<set name="sessionManager" ref="sessionManager" />
			<set name="notificationService" ref="notificationService" />
			<add name="providers" ref="googlePermitAuthProvider" />
			<add name="providers" ref="googleAuthProvider" />
		</instance>

		<instance name="deviceService" class="BeeeOn::DeviceService">
			<set name="deviceDao" ref="deviceDao" />
		</instance>

		<instance name="gatewayService" class="BeeeOn::GatewayService">
			<set name="gatewayDao" ref="gatewayDao" />
			<set name="gatewayRPC" ref="gatewayRPC" />
		</instance>

		<instance name="locationService"
				class="BeeeOn::LocationService">
			<set name="locationDao" ref="locationDao" />
		</instance>

		<instance name="fakeNotificationService"
				class="BeeeOn::FakeNotificationService" />
		<alias name="notificationService" ref="fakeNotificationService" />

		<!-- Data access layer -->

		<instance name="sessionManager" class="BeeeOn::SessionManager">
			<set name="secureRandomProvider"
				ref="pocoRandomProvider" />
			<set name="sessionExpireTime" number="${session.expire}" />
			<set name="maxUserSessions" number="${session.maxPerUser}" />
		</instance>

		<instance name="googlePermitAuthProvider"
				class="BeeeOn::PermitAuthProvider">
			<set name="resultProvider" text="google" />
		</instance>

		<instance name="googleAuthProvider"
				class="BeeeOn::GoogleAuthProvider">
			<set name="client_secret" text="${google.client_secret}"/>
			<set name="client_id" text="${google.client_id}"/>
		</instance>

		<instance name="pocoRandomProvider"
				class="BeeeOn::PocoRandomProvider" />

		<instance name="mockRandomProvider"
				class="BeeeOn::MockRandomProvider">
			<set name="nextRandom" text="0123456789abcdef" />
		</instance>

		<instance name="insecureRandomProvider"
				class="BeeeOn::InsecureRandomProvider">
			<set name="providerImpl" ref="mockRandomProvider" />
		</instance>

		<instance name="nullGatewayRPC" class="BeeeOn::NullGatewayRPC" />
		<alias name="gatewayRPC" ref="nullGatewayRPC" />

		<instance name="mockPlaceDao" class="BeeeOn::MockPlaceDao" />
		<instance name="mockUserDao" class="BeeeOn::MockUserDao" />
		<instance name="deviceDao" class="BeeeOn::MockDeviceDao" />
		<instance name="mockGatewayDao" class="BeeeOn::MockGatewayDao" />
		<instance name="mockLocationDao" class="BeeeOn::MockLocationDao" />
		<instance name="mockIdentityDao" class="BeeeOn::MockIdentityDao" />
		<instance name="mockVerifiedIdentityDao"
				class="BeeeOn::MockVerifiedIdentityDao" />

		<alias name="placeDao" ref="mockPlaceDao" />
		<alias name="userDao" ref="mockUserDao" />
		<alias name="gatewayDao" ref="mockGatewayDao" />
		<alias name="locationDao" ref="mockLocationDao" />
		<alias name="identityDao" ref="mockIdentityDao" />
		<alias name="verifiedIdentityDao" ref="mockVerifiedIdentityDao" />

		<instance name="sociManager"
				class="BeeeOn::SociManager">
			<set name="backend" text="${database.backend}" />
			<set name="connector" text="${database.connector}" />
			<set name="poolSize" number="${database.pool}" />
			<set name="initScript" text="${database.init}" />
		</instance>
	</services>
</system>
